

<!DOCTYPE html>

<html lang="pt-BR">

<head>

  <meta charset="UTF-8" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <title>Chat Firebase com √Åudio</title>

  <link rel="manifest" href="/manifest.json" />

  <meta name="theme-color" content="#075e54" />

  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>

  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-auth-compat.js"></script>

  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-database-compat.js"></script>

  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-storage-compat.js"></script>

  <style>

    .audio-btn {

      background: #075e54;

      color: white;

      border: none;

      border-radius: 50%;

      width: 40px;

      height: 40px;

      font-size: 20px;

      margin-left: 5px;

    }

  </style>

</head>

<body>

  <div class="input-area">

    <input type="text" id="message-input" placeholder="Digite uma mensagem" />

    <button id="send-btn">‚û§</button>

    <button id="record-btn" class="audio-btn">üé§</button>

  </div>



  <div id="messages"></div>



  <script>

    const firebaseConfig = {

      apiKey: "AIzaSyAb3NOMIUO-zQ9QaGIXwV8ty38cN9Yl2Gg",

      authDomain: "chat-on-1-4f38f.firebaseapp.com",

      databaseURL: "https://chat-on-1-4f38f-default-rtdb.firebaseio.com",

      projectId: "chat-on-1-4f38f",

      storageBucket: "chat-on-1-4f38f.appspot.com",

      messagingSenderId: "499742357573",

      appId: "1:499742357573:web:0cf2bed752f4e1cbb74b2c"

    };

    firebase.initializeApp(firebaseConfig);

    const auth = firebase.auth();

    const db = firebase.database();

    const storage = firebase.storage();

    const messagesRef = db.ref("messages");



    let currentUser = { uid: "temp", displayName: "Usu√°rio", photoURL: "" };

    let mediaRecorder, chunks = [];



    const recordBtn = document.getElementById("record-btn");



    recordBtn.addEventListener("click", async () => {

      if (!mediaRecorder || mediaRecorder.state === "inactive") {

        const stream = await navigator.mediaDevices.getUserMedia({ audio: true });

        mediaRecorder = new MediaRecorder(stream);

        chunks = [];



        mediaRecorder.ondataavailable = e => chunks.push(e.data);

        mediaRecorder.onstop = async () => {

          const blob = new Blob(chunks, { type: 'audio/webm' });

          const audioName = `audios/${Date.now()}_${currentUser.uid}.webm`;

          const ref = storage.ref().child(audioName);

          await ref.put(blob);

          const url = await ref.getDownloadURL();



          const msg = {

            uid: currentUser.uid,

            name: currentUser.displayName,

            avatar: currentUser.photoURL,

            audio: url,

            time: Date.now()

          };

          messagesRef.push(msg);

        };



        mediaRecorder.start();

        recordBtn.textContent = "‚óºÔ∏è";

      } else {

        mediaRecorder.stop();

        recordBtn.textContent = "üé§";

      }

    });



    function renderMessage(key, msg) {

      if (!msg.text && !msg.audio) return;

      const div = document.createElement("div");

      div.className = "msg";



      const header = document.createElement("div");

      header.className = "msg-header";



      const name = document.createElement("span");

      name.textContent = msg.name;



      header.appendChild(name);



      const content = document.createElement("div");

      content.className = "text";



      if (msg.text) {

        content.textContent = msg.text;

      } else if (msg.audio) {

        const audio = document.createElement("audio");

        audio.controls = true;

        audio.src = msg.audio;

        content.appendChild(audio);

      }



      div.appendChild(header);

      div.appendChild(content);

      document.getElementById("messages").appendChild(div);

    }

  </script>

</body>

</html>

"""



html_path = "/mnt/data/chat_com_audio_preservado.html"

Path(html_path).write_text(html_code, encoding="utf-8")

html_path
