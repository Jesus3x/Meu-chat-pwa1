<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Chat Estilo WhatsApp</title>
  <meta name="theme-color" content="#075e54" />
  <style>
    body {
      margin: 0;
      font-family: sans-serif;
      background: #ece5dd;
    }
    #login-screen, #chat-screen {
      display: none;
      flex-direction: column;
      align-items: center;
      padding: 20px;
      height: 100vh;
    }
    #login-screen {
      justify-content: center;
      background: #f5f5f5;
    }
    input, button {
      padding: 10px;
      margin: 5px;
      font-size: 16px;
    }
    header {
      width: 100%;
      background: #075e54;
      color: white;
      padding: 10px;
      font-weight: bold;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    #messages {
      flex: 1;
      width: 100%;
      overflow-y: auto;
      padding: 10px;
    }
    .msg {
      margin: 10px;
      padding: 10px;
      border-radius: 10px;
      max-width: 70%;
    }
    .sent { background: #dcf8c6; align-self: flex-end; }
    .received { background: #fff; align-self: flex-start; }
    .input-area {
      display: flex;
      align-items: center;
      padding: 10px;
      background: #fff;
      gap: 8px;
    }
    .input-area input[type="text"] {
      flex: 1;
      border: 1px solid #ccc;
      border-radius: 20px;
      padding: 10px 15px;
    }
    .input-area button {
      background: #25d366;
      border: none;
      color: white;
      border-radius: 50%;
      width: 40px;
      height: 40px;
      font-size: 18px;
      cursor: pointer;
    }
    audio, img {
      margin-top: 5px;
      max-width: 100%;
      border-radius: 8px;
    }
  </style>
  <!-- Firebase -->
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-database-compat.js"></script>
</head>
<body>
  <div id="login-screen">
    <h2>Entrar no Chat</h2>
    <input type="email" id="email" placeholder="Email">
    <input type="password" id="password" placeholder="Senha">
    <button onclick="login()">Entrar</button>
    <div id="login-error" style="color:red;"></div>
  </div>

  <div id="chat-screen">
    <header>
      <span>Chat</span>
      <button onclick="logout()">âŽ‹</button>
    </header>
    <div id="messages"></div>
    <div class="input-area">
      <input type="file" id="image-input" accept="image/*" style="display:none" />
      <button onclick="document.getElementById('image-input').click()">ðŸ“Ž</button>
      <input type="text" id="message-input" placeholder="Mensagem...">
      <button onclick="startRecording()">ðŸŽ¤</button>
      <button onclick="sendMessage()">âž¤</button>
    </div>
  </div>

<script>
  // Firebase config
  const firebaseConfig = {
    apiKey: "AIzaSyAb3NOMIUO-zQ9QaGIXwV8ty38cN9Yl2Gg",
    authDomain: "chat-on-1-4f38f.firebaseapp.com",
    databaseURL: "https://chat-on-1-4f38f-default-rtdb.firebaseio.com",
    projectId: "chat-on-1-4f38f",
    storageBucket: "chat-on-1-4f38f.appspot.com",
    messagingSenderId: "499742357573",
    appId: "1:499742357573:web:0cf2bed752f4e1cbb74b2c"
  };
  firebase.initializeApp(firebaseConfig);
  const auth = firebase.auth();
  const db = firebase.database().ref("messages");

  let currentUser = null;
  let recorder, chunks = [];

  auth.onAuthStateChanged(user => {
    if (user) {
      currentUser = user;
      showChat();
      listenMessages();
    } else {
      showLogin();
    }
  });

  function showLogin() {
    document.getElementById("login-screen").style.display = "flex";
    document.getElementById("chat-screen").style.display = "none";
  }

  function showChat() {
    document.getElementById("login-screen").style.display = "none";
    document.getElementById("chat-screen").style.display = "flex";
  }

  function login() {
    const email = document.getElementById("email").value.trim();
    const pass = document.getElementById("password").value;
    firebase.auth().signInWithEmailAndPassword(email, pass)
      .catch(() => {
        firebase.auth().createUserWithEmailAndPassword(email, pass)
          .catch(e => document.getElementById("login-error").textContent = e.message);
      });
  }

  function logout() {
    firebase.auth().signOut();
  }

  function sendMessage() {
    const text = document.getElementById("message-input").value.trim();
    if (!text) return;
    db.push({
      uid: currentUser.uid,
      text,
      time: Date.now()
    });
    document.getElementById("message-input").value = "";
  }

  function listenMessages() {
    document.getElementById("messages").innerHTML = "";
    db.on("child_added", snap => {
      const msg = snap.val();
      const div = document.createElement("div");
      div.className = "msg " + (msg.uid === currentUser.uid ? "sent" : "received");

      if (msg.text) {
        div.innerText = msg.text;
      }
      if (msg.audio) {
        const audio = document.createElement("audio");
        audio.controls = true;
        audio.src = msg.audio;
        div.appendChild(audio);
      }
      if (msg.image) {
        const img = document.createElement("img");
        img.src = msg.image;
        div.appendChild(img);
      }

      document.getElementById("messages").appendChild(div);
      document.getElementById("messages").scrollTop = document.getElementById("messages").scrollHeight;
    });
  }

  function startRecording() {
    navigator.mediaDevices.getUserMedia({ audio: true })
      .then(stream => {
        recorder = new MediaRecorder(stream);
        chunks = [];
        recorder.ondataavailable = e => chunks.push(e.data);
        recorder.onstop = () => {
          const blob = new Blob(chunks, { type: 'audio/webm' });
          const reader = new FileReader();
          reader.onloadend = () => {
            db.push({
              uid: currentUser.uid,
              audio: reader.result,
              time: Date.now()
            });
          };
          reader.readAsDataURL(blob);
        };
        recorder.start();
        setTimeout(() => { if (recorder.state === "recording") recorder.stop(); }, 10000);
      });
  }

  document.getElementById("image-input").addEventListener("change", e => {
    const file = e.target.files[0];
    if (!file) return;
    const reader = new FileReader();
    reader.onloadend = () => {
      db.push({
        uid: currentUser.uid,
        image: reader.result,
        time: Date.now()
      });
    };
    reader.readAsDataURL(file);
  });
</script>
</body>
</html>
