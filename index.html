loginBtn.onclick = async () => {
  errorMessage.textContent = '';
  const email = emailInput.value.trim();
  const password = passwordInput.value;
  const avatarFile = avatarInput.files[0];

  if (!email || !password) {
    errorMessage.textContent = 'Email e senha são obrigatórios';
    return;
  }

  try {
    // Tenta fazer login
    const cred = await auth.signInWithEmailAndPassword(email, password);
    currentUser = cred.user;
    showChat();
    startListening();
  } catch (loginError) {
    if (loginError.code === 'auth/user-not-found') {
      try {
        const cred = await auth.createUserWithEmailAndPassword(email, password);
        currentUser = cred.user;

        const displayName = email.split('@')[0];
        let photoURL = 'https://i.imgur.com/xx7JfUD.png';

        if (avatarFile) {
          const avatarRef = storage.ref().child(`avatars/${currentUser.uid}.jpg`);
          await avatarRef.put(avatarFile);
          photoURL = await avatarRef.getDownloadURL();
        }

        await currentUser.updateProfile({ displayName, photoURL });
        showChat();
        startListening();
      } catch (createError) {
        errorMessage.textContent = 'Erro ao criar usuário: ' + createError.message;
      }
    } else {
      errorMessage.textContent = 'Erro no login: ' + loginError.message;
    }
  }
};
